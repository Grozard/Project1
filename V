import psycopg2
from psycopg2 import sql
from psycopg2.extras import RealDictCursor
from datetime import datetime, timedelta
import json
import re

class WorkoutTracker:
    def __init__(self, dbname='workout_db', user='postgres', password='your_password', host='localhost'):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        """
        self.connection_params = {
            'dbname': dbname,
            'user': user,
            'password': password,
            'host': host
        }
        self.conn = None
        
    def connect_db(self):
        """
        –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        """
        try:
            self.conn = psycopg2.connect(**self.connection_params)
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
            return True
        except psycopg2.Error as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: {e}")
            return False
    
    def close_connection(self):
        """
        –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        """
        if self.conn:
            self.conn.close()
            print("üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–æ")
    
    def execute_query(self, query, params=None, fetch=False):
        """
        –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
        """
        try:
            with self.conn.cursor(cursor_factory=RealDictCursor) as cursor:
                cursor.execute(query, params)
                if fetch:
                    return cursor.fetchall()
                self.conn.commit()
                return cursor.rowcount
        except psycopg2.Error as e:
            self.conn.rollback()
            print(f"‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: {e}")
            return None
    
    # –ß–ê–°–¢–¨ –°: –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ
    
    def add_workout(self, exercise, date, sets, reps, weight, difficulty, notes):
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ
        """
        query = """
            INSERT INTO training_logs 
            (exercise_name, training_date, sets, reps, weight_kg, difficulty, notes)
            VALUES (%s, %s, %s, %s, %s, %s, %s)
            RETURNING id;
        """
        params = (exercise, date, sets, reps, weight, difficulty, notes)
        
        try:
            with self.conn.cursor() as cursor:
                cursor.execute(query, params)
                log_id = cursor.fetchone()[0]
                self.conn.commit()
                print(f"‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å ID: {log_id}")
                return log_id
        except psycopg2.Error as e:
            self.conn.rollback()
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏: {e}")
            return None
    
    def get_all_workouts(self):
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
        """
        query = """
            SELECT * FROM training_logs 
            ORDER BY training_date DESC, id DESC;
        """
        results = self.execute_query(query, fetch=True)
        
        if results:
            print(f"\nüìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: {len(results)}")
            return results
        else:
            print("üí™ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö. –°–∞–º–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è!")
            return []
    
    def search_by_exercise(self, name):
        """
        –ò—â–µ—Ç –∑–∞–ø–∏—Å–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞)
        """
        query = """
            SELECT * FROM training_logs 
            WHERE exercise_name ILIKE %s
            ORDER BY training_date DESC;
        """
        params = (f'%{name}%',)
        results = self.execute_query(query, params, fetch=True)
        
        if results:
            print(f"\nüîç –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è '{name}': {len(results)}")
            return results
        else:
            print(f"‚ùå –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ '{name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
            return []
    
    def filter_by_date(self, start_date, end_date):
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
        """
        query = """
            SELECT * FROM training_logs 
            WHERE training_date BETWEEN %s AND %s
            ORDER BY training_date DESC;
        """
        results = self.execute_query(query, (start_date, end_date), fetch=True)
        
        if results:
            print(f"\nüìÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å {start_date} –ø–æ {end_date}: {len(results)} –∑–∞–ø–∏—Å–µ–π")
            return results
        else:
            print(f"‚ùå –ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å {start_date} –ø–æ {end_date}")
            return []
    
    def update_workout(self, log_id, new_weight=None, new_reps=None, new_notes=None):
        """
        –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏
        """
        updates = []
        params = []
        
        if new_weight is not None:
            updates.append("weight_kg = %s")
            params.append(new_weight)
        if new_reps is not None:
            updates.append("reps = %s")
            params.append(new_reps)
        if new_notes is not None:
            updates.append("notes = %s")
            params.append(new_notes)
        
        if not updates:
            print("‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")
            return False
        
        query = sql.SQL("UPDATE training_logs SET {} WHERE id = %s").format(
            sql.SQL(', ').join(map(sql.SQL, updates))
        )
        params.append(log_id)
        
        rows_affected = self.execute_query(query, params)
        
        if rows_affected and rows_affected > 0:
            print(f"‚úÖ –ó–∞–ø–∏—Å—å —Å ID {log_id} –æ–±–Ω–æ–≤–ª–µ–Ω–∞")
            return True
        else:
            print(f"‚ùå –ó–∞–ø–∏—Å—å —Å ID {log_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            return False
    
    def delete_workout(self, log_id):
        """
        –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –ø–æ ID
        """
        query = "DELETE FROM training_logs WHERE id = %s;"
        rows_affected = self.execute_query(query, (log_id,))
        
        if rows_affected and rows_affected > 0:
            print(f"‚úÖ –ó–∞–ø–∏—Å—å —Å ID {log_id} —É–¥–∞–ª–µ–Ω–∞")
            return True
        else:
            print(f"‚ùå –ó–∞–ø–∏—Å—å —Å ID {log_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            return False
    
    def get_progress_stats(self):
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        """
        queries = {
            'total_workouts': "SELECT COUNT(*) as count FROM training_logs;",
            'max_weight': """
                SELECT MAX(weight_kg) as max_weight 
                FROM training_logs 
                WHERE weight_kg > 0;
            """,
            'avg_sets': "SELECT AVG(sets) as avg_sets FROM training_logs;",
            'most_frequent': """
                SELECT exercise_name, COUNT(*) as count 
                FROM training_logs 
                GROUP BY exercise_name 
                ORDER BY count DESC 
                LIMIT 1;
            """
        }
        
        stats = {}
        
        # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
        result = self.execute_query(queries['total_workouts'], fetch=True)
        stats['total_workouts'] = result[0]['count'] if result else 0
        
        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å
        result = self.execute_query(queries['max_weight'], fetch=True)
        stats['max_weight'] = result[0]['max_weight'] if result and result[0]['max_weight'] else 0
        
        # –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤
        result = self.execute_query(queries['avg_sets'], fetch=True)
        stats['avg_sets'] = round(result[0]['avg_sets'], 1) if result and result[0]['avg_sets'] else 0
        
        # –°–∞–º–æ–µ —á–∞—Å—Ç–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
        result = self.execute_query(queries['most_frequent'], fetch=True)
        if result and result[0]['exercise_name']:
            stats['most_frequent'] = result[0]['exercise_name']
            stats['freq_count'] = result[0]['count']
        else:
            stats['most_frequent'] = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'
            stats['freq_count'] = 0
        
        return stats
    
    # –ß–ê–°–¢–¨ –ï: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–î–ê–ù–ò–Ø
    
    def get_personal_records(self):
        """
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        """
        query = """
            SELECT DISTINCT ON (exercise_name) 
                exercise_name,
                weight_kg as max_weight,
                reps,
                training_date
            FROM training_logs
            WHERE weight_kg > 0
            ORDER BY exercise_name, weight_kg DESC, training_date DESC;
        """
        
        results = self.execute_query(query, fetch=True)
        
        if results:
            print("\nüèÜ –õ–ò–ß–ù–´–ï –†–ï–ö–û–†–î–´:")
            print("-" * 50)
            for record in results:
                print(f"üìå {record['exercise_name']}: {record['max_weight']} –∫–≥ "
                      f"(–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è: {record['reps']}, –¥–∞—Ç–∞: {record['training_date']})")
        else:
            print("‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤")
        
        return results
    
    def export_to_json(self, filename='workouts.json'):
        """
        –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –≤ JSON —Ñ–∞–π–ª
        """
        query = "SELECT * FROM training_logs ORDER BY training_date DESC;"
        results = self.execute_query(query, fetch=True)
        
        if results:
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º date –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            for record in results:
                if 'training_date' in record and record['training_date']:
                    record['training_date'] = record['training_date'].isoformat()
            
            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(results, f, ensure_ascii=False, indent=2)
            
            print(f"‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª {filename}")
            return True
        else:
            print("‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞")
            return False
    
    def check_reminder(self):
        """
        –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–±–∞–≤–ª—è–ª –∑–∞–ø–∏—Å–∏ –±–æ–ª—å—à–µ 7 –¥–Ω–µ–π
        """
        query = """
            SELECT MAX(training_date) as last_date
            FROM training_logs;
        """
        
        result = self.execute_query(query, fetch=True)
        
        if result and result[0]['last_date']:
            last_date = result[0]['last_date']
            days_diff = (datetime.now().date() - last_date).days
            
            if days_diff > 7:
                print(f"\n‚è∞ –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï: –í—ã –Ω–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–ª–∏—Å—å —É–∂–µ {days_diff} –¥–Ω–µ–π! "
                      f"–ü–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –±—ã–ª–∞ {last_date}")
                return True
            else:
                print(f"\n‚úÖ –û—Ç–ª–∏—á–Ω–æ! –ü–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –±—ã–ª–∞ {days_diff} –¥–Ω–µ–π –Ω–∞–∑–∞–¥")
        else:
            print("\nüí™ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö. –ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è!")
        
        return False
    
    def get_weekly_stats(self):
        """
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
        """
        week_ago = datetime.now().date() - timedelta(days=7)
        
        query = """
            SELECT 
                COUNT(*) as total_workouts,
                COUNT(DISTINCT exercise_name) as unique_exercises,
                AVG(weight_kg) as avg_weight,
                SUM(sets * reps) as total_repetitions
            FROM training_logs
            WHERE training_date >= %s;
        """
        
        result = self.execute_query(query, (week_ago,), fetch=True)
        
        if result and result[0]['total_workouts'] > 0:
            stats = result[0]
            print("\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê –ü–û–°–õ–ï–î–ù–Æ–Æ –ù–ï–î–ï–õ–Æ:")
            print("-" * 40)
            print(f"üèãÔ∏è  –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {stats['total_workouts']}")
            print(f"üìù –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: {stats['unique_exercises']}")
            print(f"‚öñÔ∏è  –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å: {round(stats['avg_weight'] or 0, 1)} –∫–≥")
            print(f"üîÑ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: {stats['total_repetitions'] or 0}")
        else:
            print("\nüìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é")
        
        return result[0] if result else None


def display_workouts(workouts):
    """
    –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    """
    if not workouts:
        return
    
    print("\n" + "="*80)
    print(f"{'ID':<4} {'–î–∞—Ç–∞':<12} {'–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ':<20} {'–ü–æ–¥—Ö–æ–¥—ã':<8} {'–ü–æ–≤—Ç–æ—Ä.':<8} {'–í–µ—Å(–∫–≥)':<8} {'–°–ª–æ–∂–Ω–æ—Å—Ç—å':<10} {'–ó–∞–º–µ—Ç–∫–∏'}")
    print("="*80)
    
    for w in workouts:
        notes = w['notes'][:20] + '...' if w['notes'] and len(w['notes']) > 20 else w['notes'] or ''
        print(f"{w['id']:<4} {w['training_date']}  {w['exercise_name']:<20} "
              f"{w['sets']:<8} {w['reps']:<8} {w['weight_kg']:<8} "
              f"{w['difficulty']:<10} {notes}")
    print("="*80)


def get_valid_input(prompt, input_type=str, allowed_values=None):
    """
    –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
    """
    while True:
        user_input = input(prompt).strip()
        
        if not user_input and input_type != str:
            print("‚ùå –ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
            continue
        
        try:
            if input_type == int:
                value = int(user_input)
                if value <= 0:
                    print("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0")
                    continue
            elif input_type == float:
                value = float(user_input)
                if value < 0:
                    print("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º")
                    continue
            else:
                value = user_input
            
            if allowed_values and value not in allowed_values:
                print(f"‚ùå –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: {', '.join(allowed_values)}")
                continue
            
            return value
        except ValueError:
            print(f"‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ {input_type.__name__}")


# –ß–ê–°–¢–¨ D: –ö–û–ù–°–û–õ–¨–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–°
def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
    """
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏)
    tracker = WorkoutTracker(
        dbname='workout_db',
        user='postgres',
        password='your_password',  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å
        host='localhost'
    )
    
    # –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    if not tracker.connect_db():
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.")
        return
    
    while True:
        print("\n" + "="*50)
        print("üèãÔ∏è  –î–ù–ï–í–ù–ò–ö –¢–†–ï–ù–ò–†–û–í–û–ö üèãÔ∏è")
        print("="*50)
        print("1. üìù –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å")
        print("2. üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏")
        print("3. üîç –ü–æ–∏—Å–∫ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é")
        print("4. üìÖ –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ")
        print("5. ‚úèÔ∏è  –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å")
        print("6. üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å")
        print("7. üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞")
        print("8. üèÜ –õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã")
        print("9. üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON")
        print("10. ‚è∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ")
        print("11. üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é")
        print("0. üö™ –í—ã—Ö–æ–¥")
        print("-"*50)
        
        choice = input("–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é: ").strip()
        
        if choice == '1':
            # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            print("\nüìù –ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨")
            exercise = get_valid_input("–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: ")
            
            date_input = input("–î–∞—Ç–∞ (–ì–ì–ì–ì-–ú–ú-–î–î, Enter –¥–ª—è —Å–µ–≥–æ–¥–Ω—è): ").strip()
            if date_input:
                # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
                if re.match(r'\d{4}-\d{2}-\d{2}', date_input):
                    date = date_input
                else:
                    print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞.")
                    date = datetime.now().date()
            else:
                date = datetime.now().date()
            
            sets = get_valid_input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤: ", int)
            reps = get_valid_input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: ", int)
            weight = get_valid_input("–í–µ—Å (–∫–≥): ", float)
            
            print("–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –ª–µ–≥–∫–æ / –Ω–æ—Ä–º–∞–ª—å–Ω–æ / —Ç—è–∂–µ–ª–æ")
            difficulty = get_valid_input("–°–ª–æ–∂–Ω–æ—Å—Ç—å: ", str, ['–ª–µ–≥–∫–æ', '–Ω–æ—Ä–º–∞–ª—å–Ω–æ', '—Ç—è–∂–µ–ª–æ'])
            
            notes = input("–ó–∞–º–µ—Ç–∫–∏: ").strip()
            
            tracker.add_workout(exercise, date, sets, reps, weight, difficulty, notes)
        
        elif choice == '2':
            # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏
            workouts = tracker.get_all_workouts()
            display_workouts(workouts)
        
        elif choice == '3':
            # –ü–æ–∏—Å–∫ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
            name = get_valid_input("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞: ")
            workouts = tracker.search_by_exercise(name)
            display_workouts(workouts)
        
        elif choice == '4':
            # –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
            print("\nüìÖ –§–ò–õ–¨–¢–† –ü–û –î–ê–¢–ï")
            start_date = get_valid_input("–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (–ì–ì–ì–ì-–ú–ú-–î–î): ")
            end_date = get_valid_input("–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (–ì–ì–ì–ì-–ú–ú-–î–î): ")
            
            workouts = tracker.filter_by_date(start_date, end_date)
            display_workouts(workouts)
        
        elif choice == '5':
            # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            log_id = get_valid_input("–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–ø–∏—Å–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ", int)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            workout = tracker.execute_query(
                "SELECT * FROM training_logs WHERE id = %s", 
                (log_id,), 
                fetch=True
            )
            
            if not workout:
                print(f"‚ùå –ó–∞–ø–∏—Å—å —Å ID {log_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                continue
            
            print(f"\n‚úèÔ∏è  –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–ü–ò–°–ò ID {log_id}")
            print("(–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å)")
            
            weight_input = input("–ù–æ–≤—ã–π –≤–µ—Å (–∫–≥): ").strip()
            new_weight = float(weight_input) if weight_input else None
            
            reps_input = input("–ù–æ–≤—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è: ").strip()
            new_reps = int(reps_input) if reps_input else None
            
            notes_input = input("–ù–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏: ").strip()
            new_notes = notes_input if notes_input else None
            
            tracker.update_workout(log_id, new_weight, new_reps, new_notes)
        
        elif choice == '6':
            # –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            log_id = get_valid_input("–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–ø–∏—Å–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: ", int)
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            confirm = input(f"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å {log_id}? (–¥/–Ω): ").lower()
            if confirm in ['–¥', '–¥–∞', 'y', 'yes']:
                tracker.delete_workout(log_id)
            else:
                print("‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ")
        
        elif choice == '7':
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            stats = tracker.get_progress_stats()
            
            print("\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ì–†–ï–°–°–ê")
            print("-" * 30)
            print(f"üìù –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {stats['total_workouts']}")
            print(f"üèãÔ∏è  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å: {stats['max_weight']} –∫–≥")
            print(f"üìä –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤: {stats['avg_sets']}")
            print(f"‚≠ê –°–∞–º–æ–µ —á–∞—Å—Ç–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: {stats['most_frequent']} "
                  f"({stats['freq_count']} —Ä–∞–∑)")
        
        elif choice == '8':
            # –õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã
            tracker.get_personal_records()
        
        elif choice == '9':
            # –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
            tracker.export_to_json()
        
        elif choice == '10':
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
            tracker.check_reminder()
        
        elif choice == '11':
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
            tracker.get_weekly_stats()
        
        elif choice == '0':
            print("\nüëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –•–æ—Ä–æ—à–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫!")
            break
        
        else:
            print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ 0-11.")
    
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
    tracker.close_connection()


if __name__ == "__main__":
    main()
